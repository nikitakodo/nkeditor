{"version":3,"sources":["keditor.js"],"names":["$","flog","KEditor","debug","args","Array","prototype","slice","apply","arguments","unshift","console","log","error","msg","Error","fn","draggable","droppable","sortable","target","options","this","element","extend","DEFAULTS","init","instances","version","niceScrollEnabled","nestedContainerEnabled","btnMoveContainerText","btnMoveComponentText","btnSettingContainerText","btnSettingComponentText","btnDuplicateContainerText","btnDuplicateComponentText","btnDeleteContainerText","btnDeleteComponentText","tabContainersText","tabContainersTitle","tabComponentsText","tabComponentsTitle","tabTooltipEnabled","extraTabs","defaultComponentType","sidebarContainer","snippetsUrl","snippetsTooltipEnabled","snippetsTooltipPosition","snippetsFilterEnabled","snippetsCategoriesSeparator","iframeMode","contentStyles","contentAreasSelector","contentAreasWrapper","containerSettingEnabled","containerSettingInitFunction","containerSettingShowFunction","containerSettingHideFunction","onReady","onInitFrame","frame","frameHead","frameBody","onSidebarToggled","isOpened","onContentChanged","event","contentArea","onBeforeInitContentArea","onInitContentArea","onBeforeInitContainer","container","onInitContainer","onBeforeContainerDeleted","selectedContainer","onContainerDeleted","onContainerChanged","changedContainer","onContainerDuplicated","originalContainer","newContainer","onContainerSelected","onContainerSnippetDropped","droppedSnippet","onComponentReady","component","onBeforeInitComponent","onInitComponent","onBeforeComponentDeleted","selectedComponent","onComponentDeleted","onComponentChanged","changedComponent","onComponentDuplicated","originalComponent","newComponent","onComponentSelected","onComponentSnippetDropped","onBeforeDynamicContentLoad","dynamicElement","onDynamicContentLoaded","response","status","xhr","onDynamicContentError","components","blank","settingEnabled","self","initFrame","window","body","document","is","htmlContent","val","keditorWrapper","after","attr","class","keditorWrapperId","generateId","html","addClass","ajaxRequest","hasClass","snippetsList","find","containerSnippets","componentSnippets","initSidebar","initKEditorClicks","initContentAreas","call","type","timestamp","Date","getTime","initNiceScroll","niceScroll","cursorcolor","cursorwidth","railpadding","top","right","left","bottom","cursorborder","disablemutationobserver","originalContent","iframe","iframeId","id","iframeDoc","contents","get","open","close","contentWindow","contentDocument","defaultView","iframeHead","iframeBody","styles","each","style","href","isArray","i","idStr","content","append","initSidebarToggler","length","ajax","dataType","url","success","resp","renderSnippets","initSnippets","initTabs","initTabsSwitcher","initSettingPanel","initSnippetsFilter","tooltip","trigger","jqXHR","lowerCaseType","toLowerCase","categories","filterHtml","tab","snippets","prepend","snippet","filterCategories","split","data","txtSearch","cbbFilter","doFilter","selectedCategory","searchText","dataCategories","dataCategoriesString","join","inArray","title","indexOf","removeClass","on","timer","clearTimeout","setTimeout","toggleSidebar","showSidebar","icon","e","preventDefault","snippetsContainerHtml","snippetsComponentHtml","snippetsContentHtml","snippetsContainerCategories","snippetsComponentCategories","trim","previewUrl","snippetHtml","concat","dataAttributes","getDataAttributes","beautifyCategories","newArray","category","push","sort","getConnectedForContainerSnippets","selector","helper","revert","connectToSortable","start","blur","stop","switcherWrapper","tabPaneWrapper","isPlainObject","tabName","tabData","text","switcherLis","tabContent","a","li","parent","activatedLi","filter","activatedPane","targetDiv","getNiceScroll","hide","targetNiceScroll","show","resize","hideSettingPanel","settingForms","form","setSettingContainer","idSettingContainer","removeAttr","getSettingContainer","setSettingComponent","idSettingComponent","getSettingComponent","showSettingPanel","isComponent","activeForm","children","componentType","getComponentType","componentData","settingTitle","settingForm","initSettingForm","loadingText","initFunction","when","done","remove","showSettingForm","activeType","hideSettingForm","getContentAreas","contentAreas","empty","initContentArea","handle","items","connectWith","axis","tolerance","receive","ui","item","snippetContent","replaceWith","initContainer","over","out","convertToContainer","contentData","isSection","wrapInner","wrap","isNested","closest","settingBtn","containerContents","containerContent","initContainerContent","parents","snippetContentElement","snippetType","initComponent","child","convertToComponent","isExisting","ignoreAttributes","attributes","name","value","replace","componentContent","isSettingEnabled","initDynamicContent","getClickedElement","sidebar","btn","getContainerContent","currentLinkedContainerContents","add","confirm","settingComponent","settingComponentParent","deleteComponent","getComponentContent","destroy","dynamicHref","param","clone","getContent","tempDiv","containerInner","not","result","setContent","jquery","getOptions","getLatestContent","instanceId","notIframeInstanceCount","keditor","instance","constructor","jQuery"],"mappings":"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","file":"keditor.min.js","sourcesContent":["(function ($) {\n    // Log function will print log message\n    var flog = function () {\n        if (typeof (console) !== 'undefined' && KEditor.debug === true) {\n            var args = Array.prototype.slice.apply(arguments);\n            args.unshift('[KEditor]');\n            \n            console.log.apply(console, args);\n        }\n    };\n    \n    // Throw error message\n    var error = function (msg) {\n        throw new Error('[KEditor] ' + msg);\n    };\n    \n    // Check dependencies\n    if (!$.fn.draggable) {\n        error('$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor.');\n    }\n    if (!$.fn.droppable) {\n        error('$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor.');\n    }\n    if (!$.fn.sortable) {\n        error('$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor.');\n    }\n    \n    // KEditor class\n    var KEditor = function (target, options) {\n        this.element = target;\n        this.options = $.extend({}, KEditor.DEFAULTS, options);\n        this.init(target);\n    };\n    \n    // KEditor instances\n    KEditor.instances = {};\n    \n    // Turn on/off debug mode\n    KEditor.debug = true;\n    \n    // Version of KEditor\n    KEditor.version = '1.1.6';\n    \n    // Default configuration of KEditor\n    KEditor.DEFAULTS = {\n        niceScrollEnabled: true,\n        nestedContainerEnabled: true,\n        btnMoveContainerText: '<i class=\"fa fa-sort\"></i>',\n        btnMoveComponentText: '<i class=\"fa fa-arrows\"></i>',\n        btnSettingContainerText: '<i class=\"fa fa-cog\"></i>',\n        btnSettingComponentText: '<i class=\"fa fa-cog\"></i>',\n        btnDuplicateContainerText: '<i class=\"fa fa-files-o\"></i>',\n        btnDuplicateComponentText: '<i class=\"fa fa-files-o\"></i>',\n        btnDeleteContainerText: '<i class=\"fa fa-times\"></i>',\n        btnDeleteComponentText: '<i class=\"fa fa-times\"></i>',\n        tabContainersText: 'Containers',\n        tabContainersTitle: 'Containers',\n        tabComponentsText: 'Components',\n        tabComponentsTitle: 'Components',\n        tabTooltipEnabled: true,\n        extraTabs: null,\n        defaultComponentType: 'blank',\n        sidebarContainer: null,\n        snippetsUrl: 'snippets/snippets.html',\n        snippetsTooltipEnabled: true,\n        snippetsTooltipPosition: 'left',\n        snippetsFilterEnabled: true,\n        snippetsCategoriesSeparator: ';',\n        iframeMode: false,\n        contentStyles: [],\n        contentAreasSelector: null,\n        contentAreasWrapper: '<div class=\"keditor-ui keditor-content-areas-wrapper\"></div>',\n        containerSettingEnabled: false,\n        containerSettingInitFunction: null,\n        containerSettingShowFunction: null,\n        containerSettingHideFunction: null,\n        onReady: function () {\n        },\n        onInitFrame: function (frame, frameHead, frameBody) {\n        },\n        onSidebarToggled: function (isOpened) {\n        },\n        onContentChanged: function (event, contentArea) {\n        },\n        \n        onBeforeInitContentArea: function (contentArea) {\n        },\n        onInitContentArea: function (contentArea) {\n        },\n        \n        onBeforeInitContainer: function (container, contentArea) {\n        },\n        onInitContainer: function (container, contentArea) {\n        },\n        onBeforeContainerDeleted: function (event, selectedContainer, contentArea) {\n        },\n        onContainerDeleted: function (event, selectedContainer, contentArea) {\n        },\n        onContainerChanged: function (event, changedContainer, contentArea) {\n        },\n        onContainerDuplicated: function (event, originalContainer, newContainer, contentArea) {\n        },\n        onContainerSelected: function (event, selectedContainer, contentArea) {\n        },\n        onContainerSnippetDropped: function (event, newContainer, droppedSnippet, contentArea) {\n        },\n        \n        onComponentReady: function (component) {\n        },\n        onBeforeInitComponent: function (component, contentArea) {\n        },\n        onInitComponent: function (component, contentArea) {\n        },\n        onBeforeComponentDeleted: function (event, selectedComponent, contentArea) {\n        },\n        onComponentDeleted: function (event, selectedComponent, contentArea) {\n        },\n        onComponentChanged: function (event, changedComponent, contentArea) {\n        },\n        onComponentDuplicated: function (event, originalComponent, newComponent, contentArea) {\n        },\n        onComponentSelected: function (event, selectedComponent, contentArea) {\n        },\n        onComponentSnippetDropped: function (event, newComponent, droppedSnippet, contentArea) {\n        },\n        \n        onBeforeDynamicContentLoad: function (dynamicElement, component, contentArea) {\n        },\n        onDynamicContentLoaded: function (dynamicElement, response, status, xhr, contentArea) {\n        },\n        onDynamicContentError: function (dynamicElement, response, status, xhr, contentArea) {\n        }\n    };\n    \n    // Component types\n    KEditor.components = {\n        blank: {\n            settingEnabled: false\n        }\n    };\n    \n    // Export log methods;\n    KEditor.log = flog;\n    KEditor.error = error;\n    \n    KEditor.prototype.init = function (target) {\n        var self = this;\n        var options = self.options;\n        \n        if (options.iframeMode) {\n            target = self.initFrame(target);\n        } else {\n            self.window = window;\n            self.body = $(document.body);\n            \n            if (target.is('textarea')) {\n                flog('Target is textarea', target);\n                \n                var htmlContent = target.val();\n                var keditorWrapper = $(options.contentAreasWrapper || '<div />');\n                target.after(keditorWrapper);\n                keditorWrapper.attr({\n                    class: 'keditor-ui keditor-wrapper'\n                });\n                \n                var keditorWrapperId = keditorWrapper.attr('id');\n                if (!keditorWrapperId) {\n                    keditorWrapperId = self.generateId('wrapper');\n                    keditorWrapper.attr('id', keditorWrapperId);\n                }\n                \n                keditorWrapper.html(htmlContent);\n                target.addClass('keditor-hidden-element');\n                target.attr('data-keditor-wrapper', '#' + keditorWrapperId);\n                \n                target = keditorWrapper;\n            }\n        }\n        \n        var body = self.body;\n        var ajaxRequest;\n        if (body.hasClass('initialized-snippets-list')) {\n            flog('Snippets list is already initialized!');\n            var snippetsList = body.find('#keditor-snippets-list');\n            self.containerSnippets = snippetsList.find('.keditor-snippet[data-type=container]');\n            self.componentSnippets = snippetsList.find('.keditor-snippet[data-type^=component]');\n        } else {\n            ajaxRequest = self.initSidebar();\n            body.addClass('initialized-snippets-list');\n        }\n        if (body.hasClass('initialized-click-event-handlers')) {\n            flog('CLick event handlers is already initialized!');\n        } else {\n            self.initKEditorClicks();\n            body.addClass('initialized-click-event-handlers');\n        }\n        \n        self.initContentAreas(target);\n        \n        if (!ajaxRequest && typeof options.onReady === 'function') {\n            options.onReady.call(self);\n        }\n    };\n    \n    KEditor.prototype.generateId = function (type) {\n        var timestamp = (new Date()).getTime();\n        return 'keditor-' + type + '-' + timestamp;\n    };\n    \n    KEditor.prototype.initNiceScroll = function (target) {\n        flog('initNiceScroll', target);\n        \n        if ($.fn.niceScroll && this.options.niceScrollEnabled) {\n            flog('Initialize $.fn.niceScroll');\n            target.niceScroll({\n                cursorcolor: '#999',\n                cursorwidth: 6,\n                railpadding: {\n                    top: 0,\n                    right: 0,\n                    left: 0,\n                    bottom: 0\n                },\n                cursorborder: '',\n                disablemutationobserver: true\n            });\n        } else {\n            flog('$.fn.niceScroll does not exist. Use default sidebar.');\n        }\n    };\n    \n    KEditor.prototype.initFrame = function (target) {\n        flog('initFrame', target);\n        \n        var self = this;\n        var options = self.options;\n        var originalContent = target.is('textarea') ? target.val() : target.html();\n        var iframe = $('<iframe />');\n        var iframeId = self.generateId('frame');\n        \n        target.after(iframe);\n        iframe.attr({\n            'id': iframeId,\n            'class': 'keditor-ui keditor-frame'\n        });\n        \n        target.addClass('keditor-hidden-element');\n        target.attr('data-keditor-frame', '#' + iframeId);\n        \n        var iframeDoc = self.iframeDoc = iframe.contents();\n        // Fix issue Firefox can't render content inside iframe\n        // ======================================================\n        iframeDoc.get(0).open();\n        iframeDoc.get(0).close();\n        // ======================================================\n        self.window = iframe[0].contentWindow ? iframe[0].contentWindow : iframe[0].contentDocument.defaultView;\n        var iframeHead = self.iframeHead = iframeDoc.find('head');\n        var iframeBody = self.iframeBody = iframeDoc.find('body');\n        \n        flog('Adding styles to iframe...');\n        var styles = '';\n        $('[data-type=\"keditor-style\"]').each(function () {\n            var style = $(this);\n            var href = style.attr('href') || style.attr('data-href') || '';\n            \n            if (href) {\n                styles += '<link rel=\"stylesheet\" type=\"text/css\" href=\"' + href + '\" />\\n';\n            } else {\n                styles += '<style type=\"text/css\">' + style.html() + '</style>\\n';\n            }\n        });\n        \n        if (options.contentStyles && $.isArray(options.contentStyles)) {\n            $.each(options.contentStyles, function (i, style) {\n                var idStr = '';\n                if (style.id) {\n                    idStr = ' id=\"' + style.id + '\" '\n                }\n                \n                if (style.href) {\n                    styles += '<link rel=\"stylesheet\" type=\"text/css\" href=\"' + style.href + '\"' + idStr + ' />\\n';\n                } else {\n                    styles += '<style type=\"text/css\"' + idStr + '>' + style.content + '</style>\\n';\n                }\n            });\n        }\n        \n        flog('Styles: \\n' + styles);\n        \n        iframeHead.append(styles);\n        flog('All styles are added');\n        \n        flog('Adding original content to iframe...');\n        if (!options.contentAreasWrapper) {\n            options.contentAreasWrapper = '<div class=\"keditor-ui keditor-content-areas-wrapper\"></div>';\n        }\n        \n        var contentAreasWrapper = self.contentAreasWrapper = $(options.contentAreasWrapper);\n        contentAreasWrapper.html(originalContent);\n        iframeBody.append(contentAreasWrapper);\n        \n        self.body = iframeBody;\n        \n        if (typeof options.onInitFrame === 'function') {\n            options.onInitFrame.call(self, iframe, iframeHead, iframeBody);\n        }\n        \n        return contentAreasWrapper;\n    };\n    \n    KEditor.prototype.initSidebar = function () {\n        flog('initSidebar');\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        body.addClass('opened-keditor-sidebar');\n        var sidebarContainer = body;\n        if (options.sidebarContainer) {\n            sidebarContainer = body.find(options.sidebarContainer);\n        }\n        \n        flog('Render Keditor sidebar');\n        sidebarContainer.append(\n            '<div id=\"keditor-sidebar\" class=\"keditor-ui\">' +\n            '   <a id=\"keditor-sidebar-toggler\" class=\"keditor-ui\"><i class=\"fa fa-chevron-right\"></i></a>' +\n            '   <div id=\"keditor-snippets-list\" class=\"keditor-ui\"></div>' +\n            '   <div id=\"keditor-snippets-content\" class=\"keditor-ui\" style=\"display: none\"></div>' +\n            '   <div id=\"keditor-setting-panel\" class=\"keditor-ui\">' +\n            '       <div id=\"keditor-setting-header\" class=\"keditor-ui\">' +\n            '           <span id=\"keditor-setting-title\" class=\"keditor-ui\"></span>' +\n            '           <a href=\"#\" id=\"keditor-setting-closer\" class=\"keditor-ui\"><i class=\"fa fa-arrow-right\"></i></a>' +\n            '       </div>' +\n            '       <div id=\"keditor-setting-body\" class=\"keditor-ui\">' +\n            '           <div id=\"keditor-setting-forms\" class=\"keditor-ui\"></div>' +\n            '       </div>' +\n            '   </div>' +\n            '</div>'\n        );\n        self.initSidebarToggler();\n        \n        if (typeof options.snippetsUrl === 'string' && options.snippetsUrl.length > 0) {\n            flog('Getting snippets form \"' + options.snippetsUrl + '\"...');\n            \n            return $.ajax({\n                type: 'get',\n                dataType: 'html',\n                url: options.snippetsUrl,\n                success: function (resp) {\n                    flog('Success in getting snippets');\n                    \n                    self.renderSnippets(resp);\n                    self.initSnippets();\n                    self.initTabs();\n                    self.initTabsSwitcher();\n                    self.initSettingPanel();\n                    \n                    if (options.snippetsFilterEnabled) {\n                        self.initSnippetsFilter('Container');\n                        self.initSnippetsFilter('Component');\n                    }\n                    \n                    if (options.snippetsTooltipEnabled || options.tabTooltipEnabled) {\n                        flog('Initialize Bootstrap tooltip plugin');\n                        body.find('#keditor-snippets-list').find('[data-toggle=\"tooltip\"]').tooltip({\n                            trigger: 'hover'\n                        });\n                    }\n                    \n                    if (typeof options.onReady === 'function') {\n                        options.onReady.call(self);\n                    }\n                },\n                error: function (jqXHR) {\n                    flog('Error when getting snippets', jqXHR);\n                }\n            });\n        } else {\n            error('\"snippetsUrl\" must be not null!');\n        }\n    };\n    \n    KEditor.prototype.initSnippetsFilter = function (type) {\n        flog('initSnippetsFilter for ' + type);\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        var lowerCaseType = type.toLowerCase();\n        var categories = self['snippets' + type + 'Categories'];\n        \n        var filterHtml = '';\n        filterHtml += '<div id=\"keditor-' + lowerCaseType + '-snippets-filter-wrapper\" class=\"keditor-ui keditor-snippets-filter-wrapper\">';\n        filterHtml += '     <input type=\"text\" id=\"keditor-' + lowerCaseType + '-snippets-search\" class=\"keditor-ui keditor-snippets-search\" value=\"\" placeholder=\"Type to search...\" />';\n        filterHtml += '     <select id=\"keditor-' + lowerCaseType + '-snippets-filter\" class=\"keditor-ui keditor-snippets-filter\">';\n        filterHtml += '         <option value=\"\" selected=\"selected\">All</option>';\n        \n        for (var i = 0; i < categories.length; i++) {\n            filterHtml += '     <option value=\"' + categories[i] + '\">' + categories[i] + '</option>';\n        }\n        \n        filterHtml += '     </select>';\n        filterHtml += '</div>';\n        \n        var tab = body.find('#keditor-' + lowerCaseType + '-snippets-tab');\n        var snippets = tab.find('.keditor-snippet');\n        tab.prepend(filterHtml);\n        \n        snippets.each(function () {\n            var snippet = $(this);\n            var categories = snippet.attr('data-keditor-categories') || '';\n            var filterCategories = categories.toLowerCase();\n            categories = categories.split(options.snippetsCategoriesSeparator);\n            filterCategories = filterCategories.split(options.snippetsCategoriesSeparator);\n            \n            snippet.data('categories', categories);\n            snippet.data('categoriesFilter', filterCategories);\n        });\n        \n        var txtSearch = tab.find('.keditor-snippets-search');\n        var cbbFilter = tab.find('.keditor-snippets-filter');\n        \n        var doFilter = function () {\n            var selectedCategory = (cbbFilter.val() || '').toLowerCase();\n            var searchText = (txtSearch.val() || '').toLowerCase();\n            \n            flog('Do filter with selected category is \"' + selectedCategory + '\" and search text is \"' + searchText + '\"');\n            \n            if (selectedCategory || searchText) {\n                flog('Filtering snippets');\n                \n                snippets.each(function () {\n                    var snippet = $(this);\n                    var dataCategories = snippet.data('categoriesFilter');\n                    var dataCategoriesString = dataCategories.join(';');\n                    var error = 0;\n                    \n                    if (selectedCategory) {\n                        if ($.inArray(selectedCategory, dataCategories) === -1) {\n                            error++;\n                        }\n                    }\n                    \n                    if (searchText) {\n                        var title = snippet.attr('title').toLowerCase();\n                        if (title.indexOf(searchText) === -1 && dataCategoriesString.indexOf(searchText) === -1) {\n                            error++;\n                        }\n                    }\n                    \n                    snippet[error === 0 ? 'removeClass' : 'addClass']('not-matched');\n                });\n            } else {\n                flog('Show all snippets');\n                snippets.removeClass('not-matched');\n            }\n        };\n        \n        cbbFilter.on('change', function () {\n            doFilter();\n        });\n        \n        var timer;\n        txtSearch.on('keydown', function () {\n            clearTimeout(timer);\n            timer = setTimeout(function () {\n                doFilter();\n            }, 200);\n        });\n    };\n    \n    KEditor.prototype.toggleSidebar = function (showSidebar) {\n        flog('toggleSidebar', showSidebar);\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        var icon = body.find('#keditor-sidebar-toggler i');\n        \n        if (showSidebar) {\n            body.addClass('opened-keditor-sidebar');\n            icon.attr('class', 'fa fa-chevron-right')\n        } else {\n            body.removeClass('opened-keditor-sidebar');\n            icon.attr('class', 'fa fa-chevron-left')\n        }\n        \n        if (typeof options.onSidebarToggled === 'function') {\n            options.onSidebarToggled.call(self, showSidebar);\n        }\n    };\n    \n    KEditor.prototype.initSidebarToggler = function () {\n        flog('initSidebarToggler');\n        \n        var self = this;\n        var body = self.body;\n        \n        body.find('#keditor-sidebar-toggler').on('click', function (e) {\n            e.preventDefault();\n            \n            self.toggleSidebar(!body.hasClass('opened-keditor-sidebar'));\n        });\n    };\n    \n    KEditor.prototype.renderSnippets = function (resp) {\n        flog('renderSnippets');\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        \n        var snippetsContainerHtml = '';\n        var snippetsComponentHtml = '';\n        var snippetsContentHtml = '';\n        \n        self.snippetsContainerCategories = [];\n        self.snippetsComponentCategories = [];\n        \n        $('<div />').html(resp).find('> div').each(function (i) {\n            var snippet = $(this);\n            var content = snippet.html().trim();\n            var previewUrl = snippet.attr('data-preview');\n            var type = snippet.attr('data-type');\n            var title = snippet.attr('data-keditor-title');\n            var snippetHtml = '';\n            var categories = snippet.attr('data-keditor-categories') || '';\n            \n            snippetHtml += '<section class=\"keditor-ui keditor-snippet\" data-snippet=\"#keditor-snippet-' + i + '\" data-type=\"' + type + '\" ' + (options.snippetsTooltipEnabled ? 'data-toggle=\"tooltip\" data-placement=\"' + options.snippetsTooltipPosition + '\"' : '') + ' title=\"' + title + '\" data-keditor-categories=\"' + categories + '\">';\n            snippetHtml += '   <img class=\"keditor-ui keditor-snippet-preview\" src=\"' + previewUrl + '\" />';\n            snippetHtml += '</section>';\n            \n            categories = categories.split(options.snippetsCategoriesSeparator);\n            \n            if (type === 'container') {\n                snippetsContainerHtml += snippetHtml;\n                self.snippetsContainerCategories = self.snippetsContainerCategories.concat(categories);\n            } else if (type.indexOf('component') !== -1) {\n                snippetsComponentHtml += snippetHtml;\n                self.snippetsComponentCategories = self.snippetsComponentCategories.concat(categories);\n            }\n            \n            var dataAttributes = self.getDataAttributes(snippet, ['data-preview', 'data-type', 'data-keditor-title', 'data-keditor-categories'], true);\n            snippetsContentHtml += '<script id=\"keditor-snippet-' + i + '\" type=\"text/html\" ' + dataAttributes.join(' ') + '>' + content + '</script>';\n        });\n        \n        self.snippetsContainerCategories = self.beautifyCategories(self.snippetsContainerCategories);\n        self.snippetsComponentCategories = self.beautifyCategories(self.snippetsComponentCategories);\n        \n        body.find('#keditor-snippets-list').html(\n            '<ul id=\"keditor-snippets-type-switcher\" class=\"keditor-ui keditor-tabs\">' +\n            '    <li class=\"keditor-ui keditor-tab active\"><a class=\"keditor-ui\" href=\"#keditor-container-snippets-tab\"' + (options.tabTooltipEnabled ? 'data-toggle=\"tooltip\" data-placement=\"bottom\"' : '') + ' title=\"' + options.tabContainersTitle + '\">' + options.tabContainersText + '</a></li>' +\n            '    <li class=\"keditor-ui keditor-tab\"><a class=\"keditor-ui\" href=\"#keditor-component-snippets-tab\"' + (options.tabTooltipEnabled ? 'data-toggle=\"tooltip\" data-placement=\"bottom\"' : '') + ' title=\"' + options.tabComponentsTitle + '\">' + options.tabComponentsText + '</a></li>' +\n            '</ul>' +\n            '<div id=\"keditor-snippets-container\" class=\"keditor-ui keditor-tabs-content\">' +\n            '   <div class=\"keditor-ui keditor-tab-content active\" id=\"keditor-container-snippets-tab\"><div class=\"keditor-ui keditor-tab-content-inner\">' + snippetsContainerHtml + '</div></div>' +\n            '   <div class=\"keditor-ui keditor-tab-content\" id=\"keditor-component-snippets-tab\"><div class=\"keditor-ui keditor-tab-content-inner\">' + snippetsComponentHtml + '</div></div>' +\n            '</div>'\n        ).addClass('loaded-snippets');\n        body.find('#keditor-snippets-content').html(snippetsContentHtml);\n    };\n    \n    KEditor.prototype.beautifyCategories = function (categories) {\n        var newArray = [];\n        for (var i = 0; i < categories.length; i++) {\n            var category = categories[i] || '';\n            \n            if (category !== '' && $.inArray(category, newArray) === -1) {\n                newArray.push(category);\n            }\n        }\n        \n        return newArray.sort();\n    };\n    \n    KEditor.prototype.getConnectedForContainerSnippets = function () {\n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        \n        var selector = '.keditor-content-area';\n        if (options.nestedContainerEnabled) {\n            selector += ',.keditor-container-content:not(.keditor-sub-container-content)';\n        }\n        \n        return body.find(selector);\n    };\n    \n    KEditor.prototype.initSnippets = function () {\n        flog('initSnippets');\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        var snippetsList = body.find('#keditor-snippets-list');\n        var containerSnippets = self.containerSnippets = snippetsList.find('.keditor-snippet[data-type=container]');\n        var componentSnippets = self.componentSnippets = snippetsList.find('.keditor-snippet[data-type^=component]');\n        \n        flog('Initialize $.fn.draggable for container snippets list');\n        containerSnippets.draggable({\n            helper: 'clone',\n            revert: 'invalid',\n            connectToSortable: self.getConnectedForContainerSnippets(),\n            start: function () {\n                body.find('[contenteditable]').blur();\n                body.find('.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                body.addClass('highlighted-container-content');\n                \n                if (options.nestedContainerEnabled) {\n                    body.find('.keditor-sub-container-content').sortable('disable');\n                }\n            },\n            stop: function () {\n                if (options.nestedContainerEnabled) {\n                    containerSnippets.draggable('option', 'connectToSortable', self.getConnectedForContainerSnippets());\n                }\n                componentSnippets.draggable('option', 'connectToSortable', body.find('.keditor-container-content'));\n                \n                if (options.nestedContainerEnabled) {\n                    body.find('.keditor-sub-container-content').sortable('enable');\n                }\n                body.removeClass('highlighted-container-content');\n            }\n        });\n        \n        componentSnippets.draggable({\n            helper: 'clone',\n            revert: 'invalid',\n            connectToSortable: body.find('.keditor-container-content'),\n            start: function () {\n                body.find('[contenteditable]').blur();\n                body.find('.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                body.addClass('highlighted-container-content');\n            },\n            stop: function () {\n                body.removeClass('highlighted-container-content');\n            }\n        });\n    };\n    \n    KEditor.prototype.initTabs = function () {\n        flog('initTabs');\n        \n        var self = this;\n        var body = self.body;\n        var options = self.options;\n        var switcherWrapper = body.find('#keditor-snippets-type-switcher');\n        var tabPaneWrapper = body.find('#keditor-snippets-container');\n        \n        if (options.extraTabs && $.isPlainObject(options.extraTabs)) {\n            flog('Add extra tabs', options.extraTabs);\n            \n            for (var tabName in options.extraTabs) {\n                var tabData = options.extraTabs[tabName];\n                \n                switcherWrapper.append('<li class=\"keditor-ui keditor-tab\"><a class=\"keditor-ui\" href=\"#keditor-extra-tab-' + tabName + '\"' + (options.tabTooltipEnabled ? 'data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"' + tabData.title + '\"' : '') + '>' + tabData.text + '</a></li>');\n                tabPaneWrapper.append('<div class=\"keditor-ui keditor-tab-content\" id=\"keditor-extra-tab-' + tabName + '\"><div class=\"keditor-tab-content-inner\">' + tabData.content + '</div></div>');\n            }\n        }\n        \n        self.initNiceScroll(tabPaneWrapper.find('.keditor-tab-content-inner'));\n    };\n    \n    KEditor.prototype.initTabsSwitcher = function () {\n        flog('initTabsSwitcher');\n        \n        var self = this;\n        var body = self.body;\n        var switcherLis = body.find('#keditor-snippets-type-switcher li');\n        var tabContent = body.find('#keditor-snippets-container .keditor-tab-content');\n        \n        switcherLis.find('a').on('click', function (e) {\n            e.preventDefault();\n            \n            var a = $(this);\n            var li = a.parent();\n            var href = a.attr('href');\n            \n            if (!li.hasClass('active')) {\n                var activatedLi = switcherLis.filter('.active');\n                var activatedPane = tabContent.filter('.active');\n                var targetDiv = body.find(href);\n                \n                activatedLi.removeClass('active');\n                activatedPane.removeClass('active');\n                \n                li.addClass('active');\n                targetDiv.addClass('active');\n                \n                if ($.fn.niceScroll && self.options.niceScrollEnabled) {\n                    activatedPane.getNiceScroll().hide();\n                    \n                    var targetNiceScroll = targetDiv.getNiceScroll();\n                    targetNiceScroll.show();\n                    targetNiceScroll.resize();\n                }\n            }\n        });\n    };\n    \n    KEditor.prototype.initSettingPanel = function () {\n        flog('initSettingPanel');\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        \n        body.find('#keditor-setting-closer').on('click', function (e) {\n            e.preventDefault();\n            \n            self.hideSettingPanel();\n        });\n        \n        var settingForms = body.find('#keditor-setting-forms');\n        self.initNiceScroll(settingForms);\n        settingForms.on('submit', 'form', function (e) {\n            e.preventDefault();\n            return false;\n        });\n        \n        if (options.containerSettingEnabled === true) {\n            if (typeof options.containerSettingInitFunction === 'function') {\n                \n                var form = $('<div id=\"keditor-container-setting\" class=\"keditor-ui keditor-setting-form clearfix\"></div>');\n                settingForms.append(form);\n                \n                flog('Initialize container setting panel');\n                options.containerSettingInitFunction.call(self, form, self);\n            } else {\n                error('\"containerSettingInitFunction\" is not function!');\n            }\n        }\n    };\n    \n    KEditor.prototype.setSettingContainer = function (container) {\n        flog('setSettingContainer', container);\n        \n        var self = this;\n        var body = self.body;\n        \n        if (container) {\n            var idSettingContainer = container.attr('id');\n            body.attr('data-setting-container', idSettingContainer);\n        } else {\n            body.removeAttr('data-setting-container');\n        }\n    };\n    \n    KEditor.prototype.getSettingContainer = function () {\n        flog('getSettingContainer');\n        \n        var self = this;\n        var body = self.body;\n        var idSettingContainer = body.attr('data-setting-container');\n        \n        return body.find('#' + idSettingContainer);\n    };\n    \n    KEditor.prototype.setSettingComponent = function (component) {\n        flog('setSettingComponent', component);\n        \n        var self = this;\n        var body = self.body;\n        \n        if (component) {\n            var idSettingComponent = component.attr('id');\n            body.attr('data-setting-component', idSettingComponent);\n        } else {\n            body.removeAttr('data-setting-component');\n        }\n    };\n    \n    KEditor.prototype.getSettingComponent = function () {\n        flog('getSettingComponent');\n        \n        var self = this;\n        var body = self.body;\n        var idSettingComponent = body.attr('data-setting-component');\n        \n        return body.find('#' + idSettingComponent);\n    };\n    \n    KEditor.prototype.showSettingPanel = function (target) {\n        flog('showSettingPanel', target);\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        var isComponent = target.is('.keditor-component');\n        \n        var activeForm = body.find('#keditor-setting-forms').children('.active');\n        activeForm.removeClass('active');\n        \n        if (isComponent) {\n            self.setSettingComponent(target);\n            self.setSettingContainer(null);\n            \n            var componentType = self.getComponentType(target);\n            var componentData = KEditor.components[componentType];\n            body.find('#keditor-setting-title').html(componentData.settingTitle);\n            \n            var settingForms = body.find('#keditor-setting-forms');\n            var settingForm = body.find('#keditor-setting-' + componentType);\n            \n            if (settingForm.length === 0) {\n                var componentData = KEditor.components[componentType];\n                if (typeof componentData.initSettingForm === 'function') {\n                    settingForm = $('<div id=\"keditor-setting-' + componentType + '\" data-type=\"' + componentType + '\" class=\"keditor-ui keditor-setting-form clearfix active\"></div>');\n                    var loadingText = $('<span />').html('Loading...');\n                    settingForms.append(settingForm);\n                    settingForm.append(loadingText);\n                    \n                    flog('Initializing setting form for component type \"' + componentType + '\"');\n                    \n                    var initFunction = componentData.initSettingForm.call(componentData, settingForm, self);\n                    $.when(initFunction).done(function () {\n                        flog('Initialized setting form for component type \"' + componentType + '\"');\n                        \n                        setTimeout(function () {\n                            loadingText.remove();\n                            \n                            if (typeof componentData.showSettingForm === 'function') {\n                                flog('Show setting form of component type \"' + componentType + '\"');\n                                componentData.showSettingForm.call(componentData, settingForm, target, self);\n                            } else {\n                                flog('\"showSettingForm\" function of component type \"' + componentType + '\" does not exist');\n                            }\n                        }, 100);\n                    });\n                } else {\n                    flog('\"initSettingForm\" function of component type \"' + componentType + '\" does not exist');\n                }\n            } else {\n                if (typeof componentData.showSettingForm === 'function') {\n                    flog('Show setting form of component type \"' + componentType + '\"');\n                    componentData.showSettingForm.call(componentData, settingForm, target, self);\n                } else {\n                    flog('\"showSettingForm\" function of component type \"' + componentType + '\" does not exist');\n                }\n                settingForm.addClass('active');\n            }\n        } else {\n            self.setSettingContainer(target);\n            self.setSettingComponent(null);\n            \n            body.find('#keditor-setting-title').html(\"Container Settings\");\n            \n            var settingForm = body.find('#keditor-container-setting');\n            if (typeof options.containerSettingShowFunction === 'function') {\n                flog('Show setting form of container');\n                options.containerSettingShowFunction.call(self, settingForm, target, self);\n            } else {\n                flog('\"containerSettingShowFunction\" does not exist');\n            }\n            settingForm.addClass('active');\n        }\n        \n        self.toggleSidebar(true);\n        body.addClass('opened-keditor-setting');\n    };\n    \n    KEditor.prototype.hideSettingPanel = function () {\n        flog('hideSettingPanel');\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        \n        body.removeClass('opened-keditor-setting');\n        \n        var activeForm = body.find('#keditor-setting-forms').children('.active');\n        if (activeForm.length > 0) {\n            if (activeForm.is('#keditor-container-setting')) {\n                if (typeof options.containerSettingHideFunction === 'function') {\n                    flog('Hide setting form of container');\n                    options.containerSettingHideFunction.call(self, activeForm, self);\n                } else {\n                    flog('\"containerSettingHideFunction\" does not exist');\n                }\n            } else {\n                var activeType = activeForm.attr('data-type');\n                var componentData = KEditor.components[activeType];\n                \n                if (typeof componentData.hideSettingForm === 'function') {\n                    flog('Hide setting form of component type \"' + activeType + '\"');\n                    componentData.hideSettingForm.call(componentData, activeForm, self);\n                } else {\n                    flog('\"hideSettingForm\" function of component type \"' + activeType + '\" does not exist');\n                }\n            }\n            \n            activeForm.removeClass('active');\n        }\n        \n        body.removeClass('opened-keditor-setting');\n        self.setSettingComponent(null);\n        self.setSettingContainer(null);\n    };\n    \n    KEditor.prototype.getContentAreas = function (target) {\n        flog('getContentAreas', target);\n        \n        var self = this;\n        var options = self.options;\n        var contentAreas;\n        if (options.contentAreasSelector) {\n            contentAreas = target.find(options.contentAreasSelector);\n        }\n        \n        if (!contentAreas || contentAreas.length === 0) {\n            flog('Do not find any content area. Creating default content area...');\n            contentAreas = $('<div />');\n            \n            var originalContent = target.html();\n            contentAreas.html(originalContent);\n            target.empty().append(contentAreas);\n        }\n        \n        return contentAreas;\n    };\n    \n    KEditor.prototype.initContentAreas = function (target) {\n        flog('initContentAreas', target);\n        \n        var self = this;\n        var contentAreas = self.getContentAreas(target);\n        \n        contentAreas.each(function () {\n            var contentArea = $(this);\n            if (!contentArea.attr('id')) {\n                contentArea.attr('id', self.generateId('content-area'));\n            }\n            \n            self.initContentArea(contentArea);\n            contentArea.data('keditor', self);\n        });\n    };\n    \n    KEditor.prototype.initContentArea = function (contentArea) {\n        flog('initContentArea', contentArea);\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        \n        contentArea.addClass('keditor-content-area');\n        \n        if (typeof options.onBeforeInitContentArea === 'function') {\n            options.onBeforeInitContentArea.call(self, contentArea);\n        }\n        \n        flog('Initialize $.fn.sortable for content area');\n        contentArea.sortable({\n            handle: '.keditor-toolbar-container:not(.keditor-toolbar-sub-container) .btn-container-reposition',\n            items: '> section',\n            helper: 'clone',\n            connectWith: '.keditor-content-area',\n            axis: 'y',\n            tolerance: 'pointer',\n            sort: function () {\n                $(this).removeClass('ui-state-default');\n            },\n            receive: function (event, ui) {\n                flog('On received snippet', event, ui);\n                \n                var helper = ui.helper;\n                var item = ui.item;\n                \n                if (item.is('.keditor-snippet')) {\n                    var snippetContent = body.find(item.attr('data-snippet')).html();\n                    flog('Snippet content', snippetContent);\n                    \n                    var container = $(\n                        '<section class=\"keditor-ui keditor-container\">' +\n                        '   <section class=\"keditor-ui keditor-container-inner\">' + snippetContent + '</section>' +\n                        '</section>'\n                    );\n                    helper.replaceWith(container);\n                    \n                    if (!container.hasClass('showed-keditor-toolbar')) {\n                        $('.keditor-container.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                        container.addClass('showed-keditor-toolbar');\n                    }\n                    \n                    if (typeof options.onContainerSnippetDropped === 'function') {\n                        options.onContainerSnippetDropped.call(self, event, container, ui.item, contentArea);\n                    }\n                    \n                    self.initContainer(contentArea, container);\n                } else {\n                    if (helper) {\n                        helper.remove();\n                    }\n                }\n                \n                self.hideSettingPanel();\n                \n                if (typeof options.onContentChanged === 'function') {\n                    options.onContentChanged.call(self, event, contentArea);\n                }\n                \n                item.addClass('keditor-ui-dragging');\n                contentArea.removeClass('keditor-highlighted-dropzone');\n            },\n            start: function (e, ui) {\n                body.addClass('highlighted-container-content');\n                ui.item.addClass('keditor-ui-dragging');\n            },\n            stop: function (e, ui) {\n                body.removeClass('highlighted-container-content');\n                contentArea.removeClass('keditor-highlighted-dropzone');\n                if (ui.helper) {\n                    ui.helper.remove();\n                }\n                ui.item.removeClass('keditor-ui-dragging');\n            },\n            over: function () {\n                contentArea.addClass('keditor-highlighted-dropzone');\n            },\n            out: function () {\n                contentArea.addClass('keditor-highlighted-dropzone');\n            }\n        });\n        \n        flog('Initialize existing containers in content area');\n        contentArea.children('section').each(function () {\n            self.convertToContainer(contentArea, $(this));\n        });\n        \n        if (typeof options.onInitContentArea === 'function') {\n            var contentData = options.onInitContentArea.call(self, contentArea);\n            if (contentData && contentData.length > 0) {\n                $.each(contentData, function () {\n                    self.convertToContainer(contentArea, $(this));\n                });\n            }\n        }\n    };\n    \n    KEditor.prototype.convertToContainer = function (contentArea, target) {\n        flog('convertToContainer', contentArea, target);\n        \n        var self = this;\n        var isSection = target.is('section');\n        var container;\n        \n        if (isSection) {\n            target.addClass('keditor-container');\n            target.wrapInner('<section class=\"keditor-ui keditor-container-inner\"></section>');\n            container = target;\n        } else {\n            target.wrap('<section class=\"keditor-ui keditor-container\"><section class=\"keditor-ui keditor-container-inner\"></section></section>');\n            container = target.parent().parent();\n        }\n        \n        self.initContainer(contentArea, container);\n    };\n    \n    KEditor.prototype.initContainer = function (contentArea, container) {\n        var self = this;\n        var options = self.options;\n        var isNested = options.nestedContainerEnabled && container.closest('[data-type=\"container-content\"]').length > 0;\n        \n        flog('initContainer - isNested=' + isNested, contentArea, container);\n        \n        if (!container.hasClass('keditor-initialized-container') || !container.hasClass('keditor-initializing-container')) {\n            container.addClass('keditor-initializing-container');\n            \n            if (typeof options.onBeforeInitContainer === 'function') {\n                options.onBeforeInitContainer.call(self, container, contentArea);\n            }\n            \n            if (isNested) {\n                container.addClass('keditor-sub-container');\n            }\n            \n            var settingBtn = '';\n            if (options.containerSettingEnabled === true) {\n                settingBtn = '<a href=\"javascript:void(0);\" class=\"keditor-ui btn-container-setting\">' + options.btnSettingContainerText + '</a>';\n            }\n            \n            flog('Render KEditor toolbar for container', container);\n            container.append(\n                '<div class=\"keditor-toolbar keditor-toolbar-container ' + (isNested ? 'keditor-toolbar-sub-container' : '') + '\">' +\n                '   <a href=\"javascript:void(0);\" class=\"keditor-ui btn-container-reposition\">' + options.btnMoveContainerText + '</a>' + settingBtn +\n                '   <a href=\"javascript:void(0);\" class=\"keditor-ui btn-container-duplicate\">' + options.btnDuplicateContainerText + '</a>' +\n                '   <a href=\"javascript:void(0);\" class=\"keditor-ui btn-container-delete\">' + options.btnDeleteContainerText + '</a>' +\n                '</div>'\n            );\n            \n            container.attr('id', self.generateId(isNested ? 'sub-container' : 'container'));\n            \n            var containerContents = container.find('[data-type=\"container-content\"]');\n            flog('Initialize ' + containerContents.length + ' container content(s)');\n            containerContents.each(function () {\n                var containerContent = $(this);\n                \n                if (options.nestedContainerEnabled) {\n                    if (isNested) {\n                        self.initContainerContent(contentArea, container, containerContent, isNested);\n                    } else {\n                        if (containerContent.parents('[data-type=\"container-content\"]').length === 0) {\n                            self.initContainerContent(contentArea, container, containerContent, isNested);\n                        }\n                    }\n                } else {\n                    self.initContainerContent(contentArea, container, containerContent, isNested);\n                }\n            });\n            \n            if (typeof options.onInitContainer === 'function') {\n                options.onInitContainer.call(self, container, contentArea);\n            }\n            \n            container.addClass('keditor-initialized-container');\n            container.removeClass('keditor-initializing-container');\n        } else {\n            if (container.hasClass('keditor-initialized-container')) {\n                flog('Container is already initialized!');\n            } else {\n                flog('Container is initializing...');\n            }\n        }\n    };\n    \n    KEditor.prototype.initContainerContent = function (contentArea, container, containerContent, isNested) {\n        flog('initContainerContent - isNested=' + isNested, contentArea, container, containerContent);\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        \n        containerContent.addClass('keditor-container-content');\n        if (isNested) {\n            containerContent.addClass('keditor-sub-container-content');\n        }\n        containerContent.attr('id', self.generateId('container-content'));\n        \n        flog('Initialize $.fn.sortable for container content');\n        containerContent.sortable({\n            handle: '.btn-component-reposition, .btn-container-reposition',\n            helper: 'clone',\n            items: '> section',\n            connectWith: '.keditor-container-content',\n            tolerance: 'pointer',\n            sort: function () {\n                $(this).removeClass('ui-state-default');\n            },\n            receive: function (event, ui) {\n                flog('On received snippet', event, ui);\n                \n                var helper = ui.helper;\n                var item = ui.item;\n                var container;\n                \n                if (item.is('.keditor-snippet')) {\n                    var snippetContentElement = body.find(item.attr('data-snippet'));\n                    var snippetContent = snippetContentElement.html();\n                    var snippetType = item.attr('data-type');\n                    flog('Snippet content', snippetContent);\n                    \n                    if (snippetType === 'container') {\n                        flog('Add nested container into container content', containerContent);\n                        \n                        var container = $(\n                            '<section class=\"keditor-ui keditor-container\">' +\n                            '   <section class=\"keditor-ui keditor-container-inner\">' + snippetContent + '</section>' +\n                            '</section>'\n                        );\n                        helper.replaceWith(container);\n                        \n                        if (!container.hasClass('showed-keditor-toolbar')) {\n                            $('.keditor-container.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                            container.addClass('showed-keditor-toolbar');\n                        }\n                        \n                        if (typeof options.onContainerSnippetDropped === 'function') {\n                            options.onContainerSnippetDropped.call(self, event, container, ui.item, contentArea);\n                        }\n                        \n                        self.initContainer(contentArea, container);\n                    } else {\n                        flog('Add component into container content', containerContent);\n                        var dataAttributes = self.getDataAttributes(snippetContentElement, null, true);\n                        var component = $(\n                            '<section class=\"keditor-ui keditor-component\" data-type=\"' + snippetType + '\" ' + dataAttributes.join(' ') + '>' +\n                            '   <section class=\"keditor-ui keditor-component-content\">' + snippetContent + '</section>' +\n                            '</section>'\n                        );\n                        helper.replaceWith(component);\n                        \n                        container = component.closest('.keditor-container');\n                        \n                        if (typeof options.onComponentSnippetDropped === 'function') {\n                            options.onComponentSnippetDropped.call(self, event, component, ui.item, contentArea);\n                        }\n                        \n                        self.initComponent(contentArea, container, component);\n                    }\n                } else {\n                    if (helper) {\n                        helper.remove();\n                    }\n                    container = item.closest('.keditor-container');\n                }\n                \n                if (!container.hasClass('showed-keditor-toolbar')) {\n                    $('.keditor-container.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                    container.addClass('showed-keditor-toolbar');\n                }\n                \n                if (typeof options.onContainerChanged === 'function') {\n                    options.onContainerChanged.call(self, event, container, contentArea);\n                }\n                \n                if (typeof options.onContentChanged === 'function') {\n                    options.onContentChanged.call(self, event, contentArea);\n                }\n                \n                item.removeClass('keditor-ui-dragging');\n                contentArea.removeClass('keditor-highlighted-dropzone');\n            },\n            start: function (e, ui) {\n                body.addClass('highlighted-container-content');\n                ui.item.addClass('keditor-ui-dragging');\n            },\n            stop: function (e, ui) {\n                body.removeClass('highlighted-container-content');\n                containerContent.removeClass('keditor-highlighted-dropzone');\n                \n                if (ui.helper) {\n                    ui.helper.remove();\n                }\n                ui.item.removeClass('keditor-ui-dragging');\n            },\n            over: function () {\n                containerContent.addClass('keditor-highlighted-dropzone');\n            },\n            out: function () {\n                containerContent.removeClass('keditor-highlighted-dropzone');\n            }\n        });\n        \n        flog('Initialize existing components inside container content');\n        containerContent.children().each(function () {\n            var child = $(this);\n            \n            if (child.find('[data-type=\"container-content\"]').length > 0) {\n                self.convertToContainer(contentArea, child);\n            } else {\n                self.convertToComponent(contentArea, container, child, true);\n            }\n        });\n    };\n    \n    KEditor.prototype.convertToComponent = function (contentArea, container, target, isExisting) {\n        flog('convertToComponent', contentArea, container, target, isExisting);\n        \n        var self = this;\n        var isSection = target.is('section');\n        var component;\n        \n        if (isSection) {\n            target.addClass('keditor-component');\n            target.wrapInner('<section class=\"keditor-ui keditor-component-content\"></section>');\n            component = target;\n        } else {\n            target.wrap('<section class=\"keditor-ui keditor-component\"><section class=\"keditor-ui keditor-component-content\"></section></section>');\n            component = target.parent().parent();\n        }\n        \n        if (isExisting) {\n            component.addClass('existing-component');\n        }\n        \n        self.initComponent(contentArea, container, component);\n    };\n    \n    KEditor.prototype.getDataAttributes = function (target, ignoreAttributes, isArray) {\n        var dataAttributes = isArray ? [] : {};\n        if (!ignoreAttributes) {\n            ignoreAttributes = [];\n        }\n        \n        $.each(target.get(0).attributes, function (i, attr) {\n            if (attr.name.indexOf('data-') === 0 && $.inArray(attr.name, ignoreAttributes) === -1) {\n                if (isArray) {\n                    dataAttributes.push(attr.name + '=\"' + attr.value + '\"');\n                } else {\n                    dataAttributes[attr.name] = attr.value;\n                }\n            }\n        });\n        \n        return dataAttributes;\n    };\n    \n    KEditor.prototype.getComponentType = function (component) {\n        flog('getComponentType', component);\n        \n        var self = this;\n        var options = self.options;\n        \n        var dataType = component.attr('data-type');\n        var componentType = dataType ? dataType.replace('component-', '') : '';\n        if (componentType && (componentType in KEditor.components)) {\n            return componentType;\n        } else {\n            if (componentType) {\n                flog('Component type \"' + componentType + '\" does not exist');\n            } else {\n                flog('This component does not contain data-type attribute');\n            }\n            \n            if (typeof options.defaultComponentType === 'string') {\n                componentType = options.defaultComponentType;\n            } else if (typeof options.defaultComponentType === 'function') {\n                componentType = options.defaultComponentType.call(self, component);\n            }\n            \n            if (!componentType) {\n                error('Component type is undefined!');\n            }\n            \n            flog('Fallback to defaultComponentType: ' + componentType);\n            return componentType;\n        }\n    };\n    \n    KEditor.prototype.initComponent = function (contentArea, container, component) {\n        flog('initComponent', contentArea, container, component);\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        \n        if (!component.hasClass('keditor-initialized-component') || !component.hasClass('keditor-initializing-component')) {\n            component.addClass('keditor-initializing-component');\n            component.attr('id', self.generateId('component'));\n            \n            if (typeof options.onBeforeInitComponent === 'function') {\n                options.onBeforeInitComponent.call(self, component, contentArea);\n            }\n            \n            var componentContent = component.children('.keditor-component-content');\n            componentContent.attr('id', self.generateId('component-content'));\n            \n            var componentType = self.getComponentType(component);\n            flog('Component type: ' + componentType);\n            \n            var componentData = KEditor.components[componentType];\n            var isSettingEnabled = componentData.settingEnabled;\n            var settingBtn = '';\n            if (isSettingEnabled) {\n                settingBtn = '<a href=\"javascript:void(0);\" class=\"keditor-ui btn-component-setting\">' + options.btnSettingComponentText + '</a>';\n            }\n            \n            flog('Render KEditor toolbar for component', component);\n            component.append(\n                '<div class=\"keditor-toolbar keditor-toolbar-component\">' +\n                '   <a href=\"javascript:void(0);\" class=\"keditor-ui btn-component-reposition\">' + options.btnMoveComponentText + '</a>' + settingBtn +\n                '   <a href=\"javascript:void(0);\" class=\"keditor-ui btn-component-duplicate\">' + options.btnDuplicateComponentText + '</a>' +\n                '   <a href=\"javascript:void(0);\" class=\"keditor-ui btn-component-delete\">' + options.btnDeleteComponentText + '</a>' +\n                '</div>'\n            );\n            \n            component.find('[data-dynamic-href]').each(function () {\n                var dynamicElement = $(this);\n                \n                self.initDynamicContent(dynamicElement);\n            });\n            \n            if (typeof componentData.init === 'function') {\n                componentData.init.call(componentData, contentArea, container, component, self);\n            } else {\n                body.removeClass('highlighted-container-content');\n                flog('\"init\" function of component type \"' + componentType + '\" does not exist');\n            }\n            \n            if (typeof options.onInitComponent === 'function') {\n                options.onInitComponent.call(self, component, contentArea);\n            }\n            \n            component.addClass('keditor-initialized-component');\n            component.removeClass('keditor-initializing-component');\n        } else {\n            if (component.hasClass('keditor-initialized-component')) {\n                flog('Component is already initialized!');\n            } else {\n                flog('Component is initializing...');\n            }\n        }\n    };\n    \n    KEditor.prototype.getClickedElement = function (event, selector) {\n        var target = $(event.target);\n        var closest = target.closest(selector);\n        \n        if (target.is(selector)) {\n            return target;\n        } else if (closest.length > 0) {\n            return closest;\n        } else {\n            return null;\n        }\n    };\n    \n    KEditor.prototype.initKEditorClicks = function () {\n        flog('initKEditorClicks');\n        \n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        \n        body.on('click', function (e) {\n            var sidebar = self.getClickedElement(e, '#keditor-sidebar');\n            \n            var container = self.getClickedElement(e, '.keditor-container');\n            if (container) {\n                if (!container.hasClass('showed-keditor-toolbar')) {\n                    body.find('.keditor-container.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                    body.find('.keditor-component.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                    container.addClass('showed-keditor-toolbar');\n                    \n                    var contentArea = container.parent();\n                    if (typeof options.onContainerSelected === 'function') {\n                        options.onContainerSelected.call(self, e, container, contentArea);\n                    }\n                }\n            } else {\n                if (!sidebar) {\n                    body.find('.keditor-container.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                    body.find('.keditor-component.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                }\n            }\n            \n            var component = self.getClickedElement(e, '.keditor-component');\n            if (component) {\n                if (!component.hasClass('showed-keditor-toolbar')) {\n                    body.find('.keditor-component.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                    component.addClass('showed-keditor-toolbar');\n                    \n                    var contentArea = component.parent();\n                    if (typeof options.onComponentSelected === 'function') {\n                        options.onComponentSelected.call(self, e, component, contentArea);\n                    }\n                }\n            } else {\n                if (!sidebar) {\n                    body.find('.keditor-component.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\n                }\n            }\n        });\n        \n        body.on('click', '.btn-container-setting', function (e) {\n            e.preventDefault();\n            \n            var btn = $(this);\n            flog('Click on .btn-container-setting', btn);\n            \n            var container = btn.closest('.keditor-container');\n            if (body.hasClass('opened-keditor-setting') && body.hasClass('opened-keditor-sidebar')) {\n                if (!container.is(self.getSettingContainer())) {\n                    self.showSettingPanel(container);\n                } else {\n                    self.hideSettingPanel();\n                }\n            } else {\n                self.showSettingPanel(container);\n            }\n        });\n        \n        body.on('click', '.btn-container-duplicate', function (e) {\n            e.preventDefault();\n            \n            var btn = $(this);\n            flog('Click on .btn-container-duplicate', btn);\n            \n            var container = btn.closest('.keditor-container');\n            var contentArea = container.parent();\n            var newContainer = $(self.getContainerContent(container, btn.parent().hasClass('keditor-toolbar-sub-container')));\n            container.after(newContainer);\n            self.convertToContainer(contentArea, newContainer);\n            \n            var snippetsList = body.find('#keditor-snippets-list');\n            var componentSnippets = snippetsList.find('.keditor-snippet[data-type^=component]');\n            var currentLinkedContainerContents = componentSnippets.draggable('option', 'connectToSortable');\n            componentSnippets.draggable('option', 'connectToSortable', currentLinkedContainerContents.add(newContainer.find('.keditor-container-content')));\n            \n            flog('Container is duplicated');\n            \n            if (typeof options.onContainerDuplicated === 'function') {\n                options.onContainerDuplicated.call(self, container, newContainer, contentArea);\n            }\n            \n            if (typeof options.onContentChanged === 'function') {\n                options.onContentChanged.call(self, e, contentArea);\n            }\n        });\n        \n        body.on('click', '.btn-container-delete', function (e) {\n            e.preventDefault();\n            \n            var btn = $(this);\n            flog('Click on .btn-container-delete', btn);\n            \n            if (confirm('Are you sure that you want to delete this container? This action can not be undo!')) {\n                var container = btn.closest('.keditor-container');\n                var components = container.find('.keditor-component');\n                var contentArea = container.parent();\n                \n                if (typeof options.onBeforeContainerDeleted === 'function') {\n                    options.onBeforeContainerDeleted.call(self, e, container, contentArea);\n                }\n                \n                var settingComponent = self.getSettingComponent();\n                if (settingComponent) {\n                    var settingComponentParent = settingComponent.closest('.keditor-container');\n                    if (settingComponentParent.is(container)) {\n                        flog('Deleting container is container of setting container. Close setting panel for this setting component', settingComponent);\n                        self.hideSettingPanel();\n                    }\n                } else if (self.getSettingContainer().is(container)) {\n                    flog('Deleting container is setting container. Close setting panel for this container', container);\n                    self.hideSettingPanel();\n                }\n                \n                if (components.length > 0) {\n                    components.each(function () {\n                        self.deleteComponent($(this));\n                    });\n                }\n                \n                container.remove();\n                \n                if (typeof options.onContainerDeleted === 'function') {\n                    options.onContainerDeleted.call(self, e, container, contentArea);\n                }\n                \n                if (typeof options.onContentChanged === 'function') {\n                    options.onContentChanged.call(self, e, contentArea);\n                }\n            }\n        });\n        \n        body.on('click', '.btn-component-setting', function (e) {\n            e.preventDefault();\n            \n            var btn = $(this);\n            flog('Click on .btn-component-setting', btn);\n            \n            var component = btn.closest('.keditor-component');\n            if (body.hasClass('opened-keditor-setting') && body.hasClass('opened-keditor-sidebar')) {\n                if (!component.is(self.getSettingComponent())) {\n                    self.showSettingPanel(component);\n                } else {\n                    self.hideSettingPanel();\n                }\n            } else {\n                self.showSettingPanel(component);\n            }\n        });\n        \n        body.on('click', '.btn-component-duplicate', function (e) {\n            e.preventDefault();\n            \n            var btn = $(this);\n            flog('Click on .btn-component-duplicate', btn);\n            \n            var component = btn.closest('.keditor-component');\n            var container = component.closest('.keditor-container');\n            var contentArea = container.parent();\n            var newComponent = $(self.getComponentContent(component));\n            \n            component.after(newComponent);\n            self.convertToComponent(contentArea, container, newComponent);\n            \n            flog('Component is duplicated');\n            \n            if (typeof options.onComponentDuplicated === 'function') {\n                options.onComponentDuplicated.call(self, component, newComponent, contentArea);\n            }\n            \n            if (typeof options.onContainerChanged === 'function') {\n                options.onContainerChanged.call(self, e, container, contentArea);\n            }\n            \n            if (typeof options.onContentChanged === 'function') {\n                options.onContentChanged.call(self, e, contentArea);\n            }\n        });\n        \n        body.on('click', '.btn-component-delete', function (e) {\n            e.preventDefault();\n            \n            var btn = $(this);\n            flog('Click on .btn-component-delete', btn);\n            \n            if (confirm('Are you sure that you want to delete this component? This action can not be undo!')) {\n                var component = btn.closest('.keditor-component');\n                var container = component.closest('.keditor-container');\n                var contentArea = component.closest('.keditor-content-area');\n                \n                if (typeof options.onBeforeComponentDeleted === 'function') {\n                    options.onBeforeComponentDeleted.call(self, e, component, contentArea);\n                }\n                \n                if (self.getSettingComponent().is(component)) {\n                    self.hideSettingPanel();\n                }\n                \n                self.deleteComponent(component);\n                \n                if (typeof options.onComponentDeleted === 'function') {\n                    options.onComponentDeleted.call(self, e, component, contentArea);\n                }\n                \n                if (typeof options.onContainerChanged === 'function') {\n                    options.onContainerChanged.call(self, e, container, contentArea);\n                }\n                \n                if (typeof options.onContentChanged === 'function') {\n                    options.onContentChanged.call(self, e, contentArea);\n                }\n            }\n        });\n    };\n    \n    KEditor.prototype.deleteComponent = function (component) {\n        flog('deleteComponent', component);\n        \n        var self = this;\n        \n        var componentType = self.getComponentType(component);\n        var componentData = KEditor.components[componentType];\n        if (typeof componentData.destroy === 'function') {\n            componentData.destroy.call(componentData, component, self);\n        } else {\n            flog('\"destroy\" function of component type \"' + componentType + '\" does not exist');\n        }\n        \n        component.remove();\n    };\n    \n    KEditor.prototype.initDynamicContent = function (dynamicElement) {\n        flog('initDynamicContent', dynamicElement);\n        \n        var self = this;\n        var options = self.options;\n        var component = dynamicElement.closest('.keditor-component');\n        var contentArea = dynamicElement.closest('.keditor-content-area');\n        \n        dynamicElement.attr('id', self.generateId('dynamic-element'));\n        \n        if (typeof options.onBeforeDynamicContentLoad === 'function') {\n            options.onBeforeDynamicContentLoad.call(self, dynamicElement, component, contentArea);\n        }\n        \n        var dynamicHref = dynamicElement.attr('data-dynamic-href');\n        var data = self.getDataAttributes(component, ['data-type', 'data-dynamic-href'], false);\n        data = $.param(data);\n        flog('Dynamic href: ' + dynamicHref, 'Data: ' + data);\n        \n        return $.ajax({\n            url: dynamicHref,\n            data: data,\n            type: 'GET',\n            dataType: 'HTML',\n            success: function (response, status, xhr) {\n                flog('Dynamic content is loaded', dynamicElement, response, status, xhr);\n                dynamicElement.html(response);\n                \n                if (typeof options.onDynamicContentLoaded === 'function') {\n                    options.onDynamicContentLoaded.call(self, dynamicElement, response, status, xhr, contentArea);\n                }\n            },\n            error: function (response, status, xhr) {\n                flog('Error when loading dynamic content', dynamicElement, response, status, xhr);\n                \n                if (typeof options.onDynamicContentError === 'function') {\n                    options.onDynamicContentError.call(self, dynamicElement, response, status, xhr, contentArea);\n                }\n            }\n        });\n    };\n    \n    KEditor.prototype.getComponentContent = function (component) {\n        flog('getComponentContent', component);\n        \n        var self = this;\n        component = component.clone();\n        var componentType = self.getComponentType(component);\n        var componentData = KEditor.components[componentType];\n        var dataAttributes = self.getDataAttributes(component, null, true);\n        var content;\n        \n        if (typeof componentData.getContent === 'function') {\n            content = componentData.getContent.call(componentData, component, self);\n        } else {\n            flog('\"getContent\" function of component type \"' + componentType + '\" does not exist. Using default getContent method');\n            var componentContent = component.children('.keditor-component-content');\n            content = componentContent.html();\n        }\n        \n        var tempDiv = $('<div />').html(content);\n        tempDiv.find('[data-dynamic-href]').each(function () {\n            $(this).html('');\n        });\n        content = tempDiv.html();\n        \n        return '<section ' + dataAttributes.join(' ') + '>' + content + '</section>';\n    };\n    \n    KEditor.prototype.getContainerContent = function (container, isNested) {\n        flog('getContainerContent - isNested=' + isNested, container);\n        \n        var self = this;\n        var containerInner = container.children('.keditor-container-inner').clone();\n        \n        containerInner.find('[data-type=container-content]').not(isNested ? '' : '.keditor-sub-container-content').each(function () {\n            var containerContent = $(this);\n            containerContent.removeClass('keditor-container-content keditor-sub-container-content ui-droppable ui-sortable').removeAttr('id');\n            \n            containerContent.children().each(function () {\n                var child = $(this);\n                \n                if (child.is('.keditor-component')) {\n                    child.replaceWith(self.getComponentContent(child));\n                } else if (child.is('.keditor-sub-container')) {\n                    child.replaceWith(self.getContainerContent(child, true));\n                }\n            });\n        });\n        \n        return '<section>' + containerInner.html() + '</section>';\n    };\n    \n    KEditor.prototype.getContent = function (inArray) {\n        var self = this;\n        var options = self.options;\n        var result = [];\n        var target = options.iframeMode ? self.body : self.element;\n        \n        if (target.is('textarea')) {\n            target = $(target.attr('data-keditor-wrapper'));\n        }\n        \n        target.find('.keditor-content-area').each(function () {\n            var html = '';\n            $(this).children('.keditor-container').each(function () {\n                var container = $(this);\n                \n                html += self.getContainerContent(container);\n            });\n            \n            result.push(html);\n        });\n        \n        return inArray ? result : result.join('\\n');\n    };\n    \n    KEditor.prototype.setContent = function (content, contentArea) {\n        var self = this;\n        var options = self.options;\n        var body = self.body;\n        var target = options.iframeMode ? self.contentAreasWrapper : self.element;\n        \n        if (target.is('textarea')) {\n            target = $(target.attr('data-keditor-wrapper'));\n        }\n        \n        if (!contentArea) {\n            contentArea = target.children();\n        } else {\n            if (!contentArea.jquery) {\n                contentArea = target.find(contentArea);\n            }\n        }\n        \n        if (contentArea.length === 0) {\n            error('Content area does not exist!');\n        }\n        \n        contentArea.html(content);\n        self.initContentArea(contentArea);\n        \n        if (options.nestedContainerEnabled) {\n            self.containerSnippets.draggable('option', 'connectToSortable', self.getConnectedForContainerSnippets());\n        }\n        self.componentSnippets.draggable('option', 'connectToSortable', body.find('.keditor-container-content'));\n    };\n    \n    KEditor.prototype.getOptions = function () {\n        return $.extend(true, {}, this.options);\n    };\n    \n    KEditor.prototype.destroy = function (getLatestContent) {\n        var target = this.element;\n        var instanceId = target.attr('data-keditor-instance');\n        \n        if (getLatestContent) {\n            var content = this.getContent(false);\n            \n            if (target.is('textarea')) {\n                target.val(content);\n            } else {\n                target.html(content);\n            }\n        }\n        \n        if (this.options.iframeMode) {\n            $(target.attr('data-keditor-frame')).remove();\n            target.removeAttr('data-keditor-frame');\n        } else {\n            if (target.is('textarea')) {\n                $(target.attr('data-keditor-wrapper')).remove();\n                target.removeAttr('data-keditor-wrapper');\n            }\n            \n            var notIframeInstanceCount = 0;\n            for (var instanceId in KEditor.instances) {\n                if (!KEditor.instances[instanceId].options.iframeMode) {\n                    notIframeInstanceCount++;\n                }\n            }\n            \n            if (notIframeInstanceCount === 0) {\n                this.body.removeClass('initialized-snippets-list opened-keditor-sidebar');\n                this.body.find('#keditor-sidebar').remove();\n            }\n        }\n        \n        target.removeAttr('data-keditor-instance');\n        target.removeClass('keditor-hidden-element');\n        target.data('keditor', null);\n        delete KEditor.instances[instanceId];\n    };\n    \n    // KEditor plugins\n    $.fn.keditor = function (options) {\n        var element = $(this);\n        var instance = element.data('keditor');\n        \n        if (typeof options == 'string') {\n            if (instance && instance[options] && typeof instance[options] === 'function') {\n                return instance[options].apply(instance, Array.prototype.slice.call(arguments, 1));\n            }\n        } else {\n            if (!instance) {\n                instance = new KEditor(element, options);\n                element.data('keditor', instance);\n                \n                var instanceId = instance.generateId('instance');\n                element.attr('data-keditor-instance', instanceId);\n                KEditor.instances[instanceId] = instance;\n            }\n            \n            return instance;\n        }\n    };\n    \n    $.fn.keditor.constructor = KEditor;\n    \n    // Export KEditor\n    $.keditor = KEditor;\n    \n})(jQuery);\n"]}